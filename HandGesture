#note install library mediapipe dan cv2 terlebih dahulu

import cv2
import mediapipe as mp
import numpy as np

# Inisialisasi MediaPipe Hands
mp_hands = mp.solutions.hands
mp_drawing = mp.solutions.drawing_utils
hands = mp_hands.Hands(
    static_image_mode=False,
    max_num_hands=1,
    min_detection_confidence=0.7,
    min_tracking_confidence=0.5
)

# Fungsi untuk menghitung jari yang diangkat
def count_fingers(landmarks):
    # Koordinat landmark tangan (dari MediaPipe)
    # 4: jempol tip, 8: telunjuk tip, 12: tengah tip, 16: manis tip, 20: kelingking tip
    # 2: jempol base, 5: telunjuk base, 9: tengah base, 13: manis base, 17: kelingking base
    
    # Untuk jempol (horizontal, bandingkan x)
    thumb_tip = landmarks[4].x
    thumb_base = landmarks[2].x
    thumb_up = thumb_tip < thumb_base  # Jika tip lebih kiri dari base (untuk tangan kanan, sesuaikan jika perlu)
    
    # Untuk jari lain (vertical, bandingkan y)
    fingers = []
    # Telunjuk
    index_tip = landmarks[8].y
    index_base = landmarks[6].y
    index_up = index_tip < index_base
    
    # Tengah
    middle_tip = landmarks[12].y
    middle_base = landmarks[10].y
    middle_up = middle_tip < middle_base
    
    # Manis
    ring_tip = landmarks[16].y
    ring_base = landmarks[14].y
    ring_up = ring_tip < ring_base
    
    # Kelingking
    pinky_tip = landmarks[20].y
    pinky_base = landmarks[18].y
    pinky_up = pinky_tip < pinky_base
    
    fingers = [thumb_up, index_up, middle_up, ring_up, pinky_up]
    
    # Hitung jumlah jari yang diangkat
    num_fingers = sum(fingers)
    
    # Deteksi spesifik
    if num_fingers == 5:
        return "hello"
    elif thumb_up and not index_up and not middle_up and not ring_up and not pinky_up:
        return "My Name"
    elif not thumb_up and index_up and not middle_up and not ring_up and not pinky_up:
        return "Is"
    elif not thumb_up and not index_up and not middle_up and not ring_up and pinky_up:
        return "Raksa"
    elif not thumb_up and index_up and middle_up and ring_up and not pinky_up:  # 3 jari: telunjuk, tengah, manis
        return "Nice To Meet You"
    else:
        return ""

# Buka kamera
cap = cv2.VideoCapture(0)

while cap.isOpened():
    ret, frame = cap.read()
    if not ret:
        break
    
    # Flip frame untuk mirror effect
    frame = cv2.flip(frame, 1)
    
    # Konversi BGR ke RGB
    rgb_frame = cv2.cvtColor(frame, cv2.COLOR_BGR2RGB)
    
    # Proses deteksi tangan
    results = hands.process(rgb_frame)
    
    # Gambar landmark jika tangan terdeteksi
    if results.multi_hand_landmarks:
        for hand_landmarks in results.multi_hand_landmarks:
            mp_drawing.draw_landmarks(
                frame, hand_landmarks, mp_hands.HAND_CONNECTIONS)
            
            # Ambil landmarks
            landmarks = hand_landmarks.landmark
            
            # Hitung gesture
            gesture = count_fingers(landmarks)
            
            # Tampilkan teks di frame
            cv2.putText(frame, gesture, (50, 50), cv2.FONT_HERSHEY_SIMPLEX, 1, (0, 255, 0), 2)
    
    # Tampilkan frame
    cv2.imshow('Hand Gesture Recognition', frame)
    
    # Keluar dengan tombol 'q'
    if cv2.waitKey(1) & 0xFF == ord('q'):
        break

# Bersihkan
cap.release()
cv2.destroyAllWindows()
